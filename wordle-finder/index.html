<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Joe's' Wordle Helper"/>
    <meta property="og:image" content="https://joeheyming.github.io/wordle-finder/thumbnail.png" />
    <meta property="og:description" content="Use strategies to solve wordle" />
    <meta property="og:url" content="https://joeheyming.github.io/wordle-finder/index.html" />
    <meta property="og:image:width" content="359" />
    <meta property="og:image:height" content="385" />
    <meta property="og:type" content="website"/>
    <script>
     var res = fetch('words');
     var words
     function isIsogram (str) {
       return !/(.).*\1/.test(str);
     }
     window.onload = function() {
       res.then(function(a) { return a.text(); }).then(function(b) {
         window.words = b.split('\n');
         words = window.words;
       });
       randomWordButton.onclick = function() {
         var word;
         var item;
         do {
           item = Math.floor(Math.random() * words.length);
           word = words[item];
         } while (!isIsogram(word));
         randomWord.textContent = word;
       }

       function guess(event) {
         event.preventDefault();
         var includeLettersJoined = includeLetters.value.toLowerCase();
         var included = includeLettersJoined.split('');
         var excluded = excludeLetters.value.toLowerCase().split('');
         var matched = words.filter(function(word) {
           return included.every(function(letter) {
             return word.match(letter) !== null;
           }) && !excluded.some(function(letter) {
             return word.match(letter) !== null;
           })
         });

         function filterSpot(spot, letter) {
           if (!letter) {
             return;
           }
           var lowerLetter = letter.toLowerCase();
           matched = matched.filter(function(word) {
             return word[spot] === lowerLetter;
           });
         }
         var spots = [first, second, third, fourth, fifth];
         spots.map(function(spot, index) {
           filterSpot(index, spot.value);
         });

         function filterNotSpot(spot, letters) {
           if (!letters) {
             return;
           }
           var lowerLetters = letters.toLowerCase().split('');
           matched = matched.filter(function(word) {
             return !lowerLetters.some(function(letter) {
               return word[spot] === letter;
             });
           });
         }

         var notSpots = [notfirst, notsecond, notthird, notfourth, notfifth];
         notSpots.map(function(spot, index) {
           filterNotSpot(index, spot.value);
         });

         letterStats = {}
         biLetterStats = {}
         matched.map(function(guess) {
           guess.split('').map(function(letter, i) {
             if (!letterStats[letter]) {
               letterStats[letter] = 0;
             }
             letterStats[letter] = letterStats[letter] + 1;

             if (i < guess.length - 1) {
               var combo = letter + guess[i+1];
               if (!biLetterStats[combo]) {
                 biLetterStats[combo] = 0;
               }
               biLetterStats[combo] = biLetterStats[combo] + 1;
             }
           });
         });

         maxStats = Object.keys(letterStats).map(function(letter) {
           return [letter, letterStats[letter]];
         });

         maxStats.sort(function(a,b) {
           return b[1] - a[1];
         });

         biMaxStats = Object.keys(biLetterStats).map(function(letter) {
           return [letter, biLetterStats[letter]];
         });

         biMaxStats.sort(function(a,b) {
           return b[1] - a[1];
         });

         notLetters = notSpots.map(function(spot) { return spot.value.toLowerCase() }).join('');
         statContent = ''
         maxStats.map(function(stat) {
           var letter = stat[0];
           var count = stat[1];
           var letterContent = letter;
           var letterClass = 'stat-letter stat-letter-block';
           if (includeLettersJoined.match(letter) !== null) {
             letterClass = letterClass + ' included-stat';
           } else if (notLetters.match(letter) !== null) {
             letterClass = letterClass + ' included-stat-wrong-spot';
           }
           statContent = statContent + '<span class="' + letterClass + '">' + letterContent + '</span>&nbsp;' + count + '\n';
         });

         comboStatContent = ''
         if (biMaxStats.length > 0) {
           comboStatContent = comboStatContent + '\n';
           biMaxStats.map(function(stat) {
             var combo = stat[0];
             var count = stat[1];
             comboStatContent = comboStatContent + '<span class="stat-letter">' + combo + '</span>:&nbsp;' + count + '\n';
           });
         }

         window['tabpanel-matches'].innerHTML = '<pre>' + matched.join('\r\n') + '</pre>';
         window['tabpanel-single'].innerHTML = '<pre>' + statContent + '</pre>';
         window['tabpanel-combo'].innerHTML = '<pre>' + comboStatContent + '</pre>';
         results.removeAttribute('hidden');
         return false;
       }
       reset.onclick = function() {
         includeLetters.value = '';
         excludeLetters.value = '';
         first.value = '';
         second.value = '';
         third.value = '';
         fourth.value = '';
         fifth.value = '';
         notfirst.value = '';
         notsecond.value = '';
         notthird.value = '';
         notfourth.value = '';
         notfifth.value = '';
         randomWord.textContent = '';
         results.setAttribute('hidden','');
       }
       guessForm.onsubmit = guess;
       submit.onclick = guess;

       const tabs = document.querySelectorAll('[role="tab"]');
       const tabList = document.querySelector('[role="tablist"]');

       function changeTabs(e) {
         const target = e.target;
         const parent = target.parentNode;
         const grandparent = parent.parentNode;

         // Remove all current selected tabs
         parent
           .querySelectorAll('[aria-selected="true"]')
           .forEach(t => t.setAttribute('aria-selected', false));

         // Set this tab as selected
         target.setAttribute('aria-selected', true);

         // Hide all tab panels
         grandparent
           .querySelectorAll('[role="tabpanel"]')
           .forEach(p => p.setAttribute('hidden', true));

         // Show the selected panel
         grandparent.parentNode
                    .querySelector(`#${target.getAttribute('aria-controls')}`)
                    .removeAttribute('hidden');
       }
       // Add a click event handler to each tab
       tabs.forEach(tab => {
         tab.addEventListener('click', changeTabs);
       });

     }
    </script>
    <style>
     label {
       width: 100px;
       display: inline-table;
       margin-right: 10px;
       vertical-align: middle;
     }

     input[type=text] {
       text-transform: uppercase;
       font-weight: bold;
       text-align: center;
       color: white;
     }

     .corrects input {
       background-color: #6aaa64;
       width: 30px;
       height: 30px;
       border: 2px solid #787c7e;
     }

     input.incorrect {
       background-color: #86888a;
       height: 30px;
       border: 2px solid #787c7e;
       width: 200px;
       margin-left: 4px;
     }
     input.correct {
       background-color: #6aaa64;
       height: 30px;
       border: 2px solid #787c7e;
       width: 200px;
       margin-left: 4px;
     }

     .maybecorrects input {
       background-color: #c9b458;
       width: 30px;
       height: 30px;
       border: 2px solid #787c7e;
     }

     .stat-letter {
       margin: 5px 5px 5px 0px;
       display: inline-block;
       height: 100%;
       text-align: center;
       content: '';
       font-weight: 600;
       width: 30px;
     }

     .stat-letter-block {
       border: solid 1px #787c7e;
       width: 20px;
     }
     .included-stat {
       color: white;
       background-color: #6aaa64;
     }
     .included-stat-wrong-spot {
       color: white;
       background-color: #c9b458;
     }

     #randomWord {
       font-weight: 600;
       text-transform: uppercase;
       margin-left: 15px;
     }
     body {
       font-family: Arial;
       margin-left: auto;
       width: calc(100vw - 50px);
       margin-right: auto;
     }
     pre {
       font-family: sans-serif;
       text-transform: uppercase;
       column-count: 4;
     }

     #results {
       margin-top: 10px;
     }
     .panels {
       max-height: 300px;
       overflow-y: auto;
     }
     #results [role=tablist] {
       border-bottom: solid 1px #787c7e;
     }

     #results button[role=tab] {
       border: solid 1px #787c7e;
       color: inherit;
       background-color: inherit;
       border-bottom: none;
     }

     #results button[role=tab]:hover, #results button[role=tab]:focus, #results button[role=tab][aria-selected=true]  {
       color: black;
       background-color: #c9b458;
     }

     button {
       font-weight: bold;
       display: inline-block;
       padding: 8px 16px;
       vertical-align: middle;
       overflow: hidden;
       text-decoration: none;
       text-align: center;
       cursor: pointer;
       white-space: nowrap;
       width: auto;
       outline: 0;
       border: solid 1px #787c7e;
     }

     #submit {
       color: white;
       background-color: #6aaa64;
     }

    </style>
  </head>
  <body>
    <h1>Joe's Wordle Helper</h1>
    <label>Random start word</label>
    <button id="randomWordButton">Go</button>
    <span id="randomWord"></span>
    <br />

    <form id="guessForm" autocomplete="off">
      <br />
      <label>Include</label><input autocomplete="off" maxlength="5" class="correct" type="text" id="includeLetters" /><br />
      <br />
      <label>Exclude</label><input autocomplete="off" class="incorrect" type="text" id="excludeLetters" /><br />
      <br />
      <div class="corrects">
        <label>Include in these spots</label>
        <input autocomplete="off" type="text" maxlength="1" size="1" id="first" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="second" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="third" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="fourth" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="fifth" />
      </div>
      <br />
      <div class="maybecorrects">
        <label>Ignore in these spots</label>
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notfirst" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notsecond" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notthird" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notfourth" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notfifth" />
      </div>
      <br />

      <input type="submit" style="display: none;"/>
    </form>
    <button id="submit">Submit</button>
    <button id="reset">Reset</button>
    <br />

    <div id="results" hidden>
      <div role="tablist">
        <button aria-selected="true"  role="tab" aria-controls="tabpanel-matches" id="matches">Matches</button>
        <button aria-selected="false" role="tab" aria-controls="tabpanel-single" id="single-stats">Letter Stats</button>
        <button aria-selected="false" role="tab" aria-controls="tabpanel-combo" id="combo-stats">Combo Stats</button>
      </div>
      <div class="panels">
        <div id="tabpanel-matches" role="tabpanel" tabindex="0" aria-labelledby="matches"></div>
        <div id="tabpanel-single" role="tabpanel" tabindex="0" aria-labelledby="single-stats" hidden></div>
        <div id="tabpanel-combo" role="tabpanel" tabindex="0" aria-labelledby="combo-stats" hidden></div>
      </div>
    </div>
  </body>
</html>
