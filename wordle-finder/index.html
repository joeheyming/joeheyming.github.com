<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Joe's' Wordle Helper"/>
    <meta property="og:image" content="https://joeheyming.github.io/wordle-finder/thumbnail.png" />
    <meta property="og:description" content="Use strategies to solve wordle" />
    <meta property="og:url" content="https://joeheyming.github.io/wordle-finder/index.html" />
    <meta property="og:image:width" content="359" />
    <meta property="og:image:height" content="385" />
    <meta property="og:type" content="website"/>
    <script>
     var res = fetch('words');
     var words
     function isIsogram (str) {
       return !/(.).*\1/.test(str);
     }
     window.onload = function() {
       res.then(function(a) { return a.text(); }).then(function(b) {
         window.words = b.split('\n');
         words = window.words;
       });
       randomWordButton.onclick = function() {
         var word;
         var item;
         do {
           item = Math.floor(Math.random() * words.length);
           word = words[item];
         } while (!isIsogram(word));
         randomWord.textContent = word;
       }

       function guess(event) {
         event.preventDefault();
         var includeLettersJoined = includeLetters.value.toLowerCase();
         var included = includeLettersJoined.split('');
         var excluded = excludeLetters.value.toLowerCase().split('');
         var matched = words.filter(function(word) {
           return included.every(function(letter) {
             return word.match(letter) !== null;
           }) && !excluded.some(function(letter) {
             return word.match(letter) !== null;
           })
         });

         function filterSpot(spot, letter) {
           if (!letter) {
             return;
           }
           var lowerLetter = letter.toLowerCase();
           matched = matched.filter(function(word) {
             return word[spot] === lowerLetter;
           });
         }
         var spots = [first, second, third, fourth, fifth];
         spots.map(function(spot, index) {
           filterSpot(index, spot.value);
         });

         function filterNotSpot(spot, letters) {
           if (!letters) {
             return;
           }
           var lowerLetters = letters.toLowerCase().split('');
           matched = matched.filter(function(word) {
             return !lowerLetters.some(function(letter) {
               return word[spot] === letter;
             });
           });
         }

         var notSpots = [notfirst, notsecond, notthird, notfourth, notfifth];
         notSpots.map(function(spot, index) {
           filterNotSpot(index, spot.value);
         });

         var letterStats = {}
         var biLetterStats = {}
         matched.map(function(guess) {
           guess.split('').map(function(letter, i) {
             if (!letterStats[letter]) {
               letterStats[letter] = 0;
             }
             letterStats[letter] = letterStats[letter] + 1;

             if (i < guess.length - 1) {
               var combo = letter + guess[i+1];
               if (!biLetterStats[combo]) {
                 biLetterStats[combo] = 0;
               }
               biLetterStats[combo] = biLetterStats[combo] + 1;
             }
           });
         });

         var matchStats = {};
         matched.map(function(match) {
           matchStats[match] = 0; 
         });

         maxStats = Object.keys(letterStats).map(function(letter) {
           matched.map(function(match) {
             if (match.indexOf(letter) !== -1) {
               matchStats[match] = matchStats[match] + letterStats[letter];
             }
           });
           return [letter, letterStats[letter]];
         });

         maxStats.sort(function(a,b) {
           return b[1] - a[1];
         });

         var biMaxStats = Object.keys(biLetterStats).map(function(letter) {
           matched.map(function(match) {
             if (match.indexOf(letter) !== -1) {
               matchStats[match] = matchStats[match] + biLetterStats[letter];
             }
           });

           return [letter, biLetterStats[letter], new RegExp(letter)];
         });

         biMaxStats.sort(function(a,b) {
           return b[1] - a[1];
         });

         var scores = Object.keys(matchStats).map(function(match) {
           return [match, matchStats[match]];
         });
         scores.sort(function(a,b) {
           return b[1] - a[1];
         });
         var scoreContent = '\r\n<h3>Top Words by Frequency</h3>\r\n<pre>' + scores.map(function(score, i) {
           return (i+1) + ': ' + score[0];
         }).join('\r\n') + '</pre>';

         notLetters = notSpots.map(function(spot) { return spot.value.toLowerCase() }).join('');
         statContent = ''
         maxStats.map(function(stat) {
           var letter = stat[0];
           var count = stat[1];
           var letterContent = letter;
           var letterClass = 'stat-letter stat-letter-block';
           if (includeLettersJoined.match(letter) !== null) {
             letterClass = letterClass + ' included-stat';
           } else if (notLetters.match(letter) !== null) {
             letterClass = letterClass + ' included-stat-wrong-spot';
           }
           statContent = statContent + '<span class="' + letterClass + '">' + letterContent + '</span>&nbsp;' + count + '\n';
         });

         comboStatContent = ''
         if (biMaxStats.length > 0) {
           comboStatContent = comboStatContent + '\n';
           biMaxStats.map(function(stat) {
             var combo = stat[0];
             var count = stat[1];
             comboStatContent = comboStatContent + '<span class="stat-letter">' + combo + '</span>:&nbsp;' + count + '\n';
           });
         }

         window['tabpanel-matches'].innerHTML = '<pre>' + matched.join('\r\n') + '</pre>';
         window['tabpanel-single'].innerHTML = '<h3>Letter Counts</h3><pre>' + statContent + '</pre>' + scoreContent ;
         window['tabpanel-combo'].innerHTML = '<pre>' + comboStatContent + '</pre>';
         results.removeAttribute('hidden');
         return false;
       }
       reset.onclick = function() {
         includeLetters.value = '';
         excludeLetters.value = '';
         first.value = '';
         second.value = '';
         third.value = '';
         fourth.value = '';
         fifth.value = '';
         notfirst.value = '';
         notsecond.value = '';
         notthird.value = '';
         notfourth.value = '';
         notfifth.value = '';
         randomWord.textContent = '';
         results.setAttribute('hidden','');
       }
       guessForm.onsubmit = guess;
       submit.onclick = guess;

       const tabs = document.querySelectorAll('[role="tab"]');
       const tabList = document.querySelector('[role="tablist"]');

       function changeTabs(e) {
         const target = e.target;
         const parent = target.parentNode;
         const grandparent = parent.parentNode;

         // Remove all current selected tabs
         parent
           .querySelectorAll('[aria-selected="true"]')
           .forEach(t => t.setAttribute('aria-selected', false));

         // Set this tab as selected
         target.setAttribute('aria-selected', true);

         // Hide all tab panels
         grandparent
           .querySelectorAll('[role="tabpanel"]')
           .forEach(p => p.setAttribute('hidden', true));

         // Show the selected panel
         grandparent.parentNode
                    .querySelector(`#${target.getAttribute('aria-controls')}`)
                    .removeAttribute('hidden');
       }
       // Add a click event handler to each tab
       tabs.forEach(tab => {
         tab.addEventListener('click', changeTabs);
     });

     }
    </script>
    <style>
     label {
       width: 100px;
       display: inline-table;
       margin-right: 10px;
       vertical-align: middle;
     }

     input[type=text] {
       text-transform: uppercase;
       font-weight: bold;
       text-align: center;
       color: white;
     }

     .corrects input {
       background-color: #6aaa64;
       width: 30px;
       height: 30px;
       border: 2px solid #787c7e;
     }

     input.incorrect {
       background-color: #86888a;
       height: 30px;
       border: 2px solid #787c7e;
       width: 200px;
       margin-left: 4px;
     }
     input.correct {
       background-color: #6aaa64;
       height: 30px;
       border: 2px solid #787c7e;
       width: 200px;
       margin-left: 4px;
     }

     .maybecorrects input {
       background-color: #c9b458;
       width: 30px;
       height: 30px;
       border: 2px solid #787c7e;
     }

     .stat-letter {
       margin: 5px 5px 5px 0px;
       display: inline-block;
       height: 100%;
       text-align: center;
       content: '';
       font-weight: 600;
       width: 30px;
     }

     .stat-letter-block {
       border: solid 1px #787c7e;
       width: 20px;
     }
     .included-stat {
       color: white;
       background-color: #6aaa64;
     }
     .included-stat-wrong-spot {
       color: white;
       background-color: #c9b458;
     }

     #randomWord {
       font-weight: 600;
       text-transform: uppercase;
       margin-left: 15px;
     }
     body {
       font-family: Arial;
       margin-left: auto;
       width: calc(100vw - 50px);
       margin-right: auto;
     }
     pre {
       font-family: sans-serif;
       text-transform: uppercase;
       column-count: 4;
     }

     #results {
       margin-top: 10px;
     }
     .panels {
       max-height: 300px;
       overflow-y: auto;
     }
     #results [role=tablist] {
       border-bottom: solid 1px #787c7e;
     }

     #results button[role=tab] {
       border: solid 1px #787c7e;
       color: inherit;
       background-color: inherit;
       border-bottom: none;
     }

     #results button[role=tab]:hover, #results button[role=tab]:focus, #results button[role=tab][aria-selected=true]  {
       color: black;
       background-color: #c9b458;
     }

     button {
       font-weight: bold;
       display: inline-block;
       padding: 8px 16px;
       vertical-align: middle;
       overflow: hidden;
       text-decoration: none;
       text-align: center;
       cursor: pointer;
       white-space: nowrap;
       width: auto;
       outline: 0;
       border: solid 1px #787c7e;
     }
     button:focus {
       outline: 3px solid #ffbf47;
       outline-offset: 0;
     }

     #submit {
       color: white;
       background-color: #6aaa64;
     }

     .info {
       background-color: #00a5ff;
       border: none;
       border-radius: 100%;
       padding: 5px;
       line-height: 5px;
       color: white;
     }
     .modal-layer {
       z-index: 3;
       position: fixed;
       left: 0;
       top: 0;
       width: 100%;
       height: 100%;
       overflow: auto;
       background-color: rgba(0,0,0,0.4);
       display: flex;
       flex: 1;
       flex-direction: column;
       align-items: center;
       justify-content: center;
     }
     .modal {
       display: block;
       background-color: white;
       width: 80vw;
       height: 600px;
       border-radius: 4px;
     }

     .modal-title {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin: 0 20px;
     }
     .modal-content {
       height: 500px;
       margin: 0 20px;
       overflow-y: auto;
     }
     .modal-content img {
       max-width: 100%;
     }
     .close-modal {
       border: none;
     }

    </style>
  </head>
  <body>
    <div id="dialog" class="modal-layer" style="display: none;">
      <div class="modal">
        <div class="modal-title">
          <h2>Help</h2>
          <button class="close-modal" onclick="dialog.style.display = 'none'">X</button>
        </div>
        <hr />
        <div class="modal-content">
          <p>
            This tool helps narrow the possible words you can choose for Wordle.
            To start wordle, you need a word to start with.
            The <strong>Random start word</strong> section helps give you a start word with non-repeating letters.
          </p>
          <img src="random-words.png" alt="How to generate random words."/>
          <p>
            Once you know the results of your first guess, you can input the letters you know are correct into the include section.

            Letters you don't want should be added to the exclude section.
          </p>
          <img src="include-exclude.png" alt="How to include and exclude letters."/>

          <p>
            If you know correct letters, and you know the right spot they should be in,
            add the letter to the correct spot in the <strong>Include in these spots</strong> section.

            If you know correct letters, and know the incorrect spots they are in,
            simply add the letters to the <strong>Ignore in these spots</strong> section.

            Once you are done, click submit.
          </p>
          <img src="spots.png" alt="How to narrow results of a particular spot."/>

          <p>
            All matches will be shown after clicking <strong>Submit</strong>.
            Statistics for the matches are provided in separate tabs.
            The <strong>reset</strong> button can be used when starting a new game.
          </p>
          <img src="results.png" alt="A sample view of results."/>

          <p>
            Statistics include the frequency of all letters and the frequency of each pair of letters in the word list.
            The frequency of all the letters and the pairs of letters are used as weights to generate a score for each match.
            Matches are sorted by score in the statistics tab.
          </p>
        </div>
      </div>
    </div>
    <h1>Joe's Wordle Helper <button onclick="dialog.style.display = ''" class="info">ℹ</button></h1>
    <label>Random start word</label>
    <button id="randomWordButton">Go</button>
    <span id="randomWord"></span>
    <br />

    <form id="guessForm" autocomplete="off">
      <br />
      <label>Include</label><input autocomplete="off" maxlength="5" class="correct" type="text" id="includeLetters" /><br />
      <br />
      <label>Exclude</label><input autocomplete="off" class="incorrect" type="text" id="excludeLetters" /><br />
      <br />
      <div class="corrects">
        <label>Include in these spots</label>
        <input autocomplete="off" type="text" maxlength="1" size="1" id="first" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="second" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="third" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="fourth" />
        <input autocomplete="off" type="text" maxlength="1" size="1" id="fifth" />
      </div>
      <br />
      <div class="maybecorrects">
        <label>Ignore in these spots</label>
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notfirst" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notsecond" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notthird" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notfourth" />
        <input autocomplete="off" type="text" maxlength="5" size="5" id="notfifth" />
      </div>
      <br />

      <input type="submit" style="display: none;"/>
    </form>
    <button id="submit">Submit</button>
    <button id="reset">Reset</button>
    <br />

    <div id="results" hidden>
      <div role="tablist">
        <button aria-selected="true"  role="tab" aria-controls="tabpanel-matches" id="matches">Matches</button>
        <button aria-selected="false" role="tab" aria-controls="tabpanel-single" id="single-stats">Letter Stats</button>
        <button aria-selected="false" role="tab" aria-controls="tabpanel-combo" id="combo-stats">Combo Stats</button>
      </div>
      <div class="panels">
        <div id="tabpanel-matches" role="tabpanel" tabindex="0" aria-labelledby="matches"></div>
        <div id="tabpanel-single" role="tabpanel" tabindex="0" aria-labelledby="single-stats" hidden></div>
        <div id="tabpanel-combo" role="tabpanel" tabindex="0" aria-labelledby="combo-stats" hidden></div>
      </div>
    </div>
  </body>
</html>
